/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);
var __async = (__this, __arguments, generator) => {
  return new Promise((resolve, reject) => {
    var fulfilled = (value) => {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    };
    var rejected = (value) => {
      try {
        step(generator.throw(value));
      } catch (e) {
        reject(e);
      }
    };
    var step = (x) => x.done ? resolve(x.value) : Promise.resolve(x.value).then(fulfilled, rejected);
    step((generator = generator.apply(__this, __arguments)).next());
  });
};

// src/main.ts
var main_exports = {};
__export(main_exports, {
  default: () => MyPlugin
});
module.exports = __toCommonJS(main_exports);
var import_obsidian3 = require("obsidian");

// src/Dialog/dialog.ts
var import_obsidian = require("obsidian");
var ExampleModal = class extends import_obsidian.Modal {
  constructor(app, onSubmit) {
    super(app);
    this.onSubmit = onSubmit;
  }
  onOpen() {
    const { contentEl } = this;
    contentEl.createEl("h6", { text: "\u60A8\u7684\u60F3\u6CD5\u662F\uFF1F" });
    const stylingTemplateSetting = new import_obsidian.Setting(contentEl);
    const stylingTemplateContent = new import_obsidian.TextAreaComponent(stylingTemplateSetting.controlEl);
    stylingTemplateSetting.settingEl.setAttribute("style", "display: grid; grid-template-columns: 1fr;");
    stylingTemplateContent.inputEl.setAttribute("style", "width: 100%;  height: 18vh;");
    stylingTemplateContent.onChange((value) => __async(this, null, function* () {
      this.result = value.replace(/\n/g, "<br>");
    }));
    new import_obsidian.Setting(contentEl).addButton((btn) => btn.setButtonText("\u786E\u5B9A").setCta().onClick(() => {
      this.close();
      this.onSubmit(this.result);
    }));
  }
  onClose() {
    let { contentEl } = this;
    contentEl.empty();
  }
};

// src/Plugin/EditorExtension.ts
var import_view = require("@codemirror/view");
var import_obsidian2 = require("obsidian");
var label = "View notes";
var addSrcButton = (app) => {
  const apply = () => app.workspace.iterateAllLeaves(addButton(app));
  app.workspace.onLayoutReady(apply);
  app.workspace.on("layout-change", apply);
};
var addButton = (app) => (leaf) => {
  if (leaf.view instanceof import_obsidian2.MarkdownView && leaf.view.containerEl.querySelector(
    `a.view-action[aria-label="${label}"]`
  ) === null) {
    let view = leaf.view;
    let isWork = false;
    const buttonElement = view.addAction("pdf-file", label, (evt) => {
      const rightGutters = view.contentEl.querySelector("#right-gutters");
      if (isWork) {
        isWork = false;
        rightGutters.setAttribute("style", "display:block");
        rightGutters.setAttribute("style", "background-color:rgb(246, 248, 250)!important;width:250px;margin-right: 30px");
        (0, import_obsidian2.setIcon)(buttonElement, "pdf-file");
      } else {
        isWork = true;
        rightGutters.setAttribute("style", "display:none");
        (0, import_obsidian2.setIcon)(buttonElement, "add-note-glyph");
      }
    });
  }
};
function EditingViewPlugin(app) {
  return import_view.ViewPlugin.fromClass(
    class ExamplePlugin {
      constructor(view) {
        this.prevViewport = view.viewport;
        this.dom = document.createElement("div");
        this.dom.className = "cm-gutters";
        this.dom.setAttribute("style", "background-color:rgb(246, 248, 250)!important;width:250px;margin-right: 30px");
        this.dom.setAttribute("id", "right-gutters");
        this.dom.style.minHeight = view.contentHeight + "px";
        view.scrollDOM.insertAfter(this.dom, view.contentDOM.nextSibling);
        addSrcButton(app);
      }
      setCommnet(view) {
        const _get_gutter = view.dom.querySelector("#right-gutters");
        if (_get_gutter) {
          _get_gutter.empty();
          const findComment = view.contentDOM.querySelectorAll(".comment");
          if (findComment.length === 0) {
            const findStyle = view.contentDOM.querySelectorAll(".cm-line");
            findStyle.forEach(($el) => {
              let getStyles = $el.getAttribute("style");
              if (getStyles) {
                if (getStyles.endsWith("top:0px")) {
                  $el.removeAttribute("style");
                }
                ;
              }
            });
          }
          findComment.forEach((element) => {
            if (element) {
              const comments = document.createElement("div");
              comments.style.top = element.parentElement.parentElement.parentElement.offsetTop + "px";
              comments.style.position = "absolute";
              comments.style.zIndex = "99";
              comments.style.cursor = "pointer";
              comments.style.whiteSpace = "pre-wrap";
              comments.addClass("rightComments");
              comments.innerHTML = element.innerHTML;
              _get_gutter.append(comments);
              comments.onclick = (e) => {
                comments.setAttribute("contenteditable", "plaintext-only");
                comments.style.cursor = "text";
                comments.style.border = "1px solid #00f";
              };
              comments.onblur = (e) => {
                const node = view.contentDOM.querySelector("#" + element.getAttribute("id"));
                const newText = e.target.innerText;
                const { state } = view;
                const position = view.posAtDOM(node);
                const line = state.doc.lineAt(position);
                const Exp = RegExp("(" + element.getAttribute("id") + "'>)([\\s\\S]*?)(</span>)", "g");
                const test = line.text.replace(Exp, "$1" + newText + "$3");
                view.dispatch({ changes: { from: line.from, to: line.to, insert: test.replace(/\n/g, "<br>") } });
              };
              if (comments.offsetHeight + 5 >= element.parentElement.parentElement.parentElement.offsetHeight) {
                element.parentElement.parentElement.parentElement.setAttribute("style", `height:${comments.offsetHeight + 5}px;top:0px`);
              } else {
                element.parentElement.parentElement.parentElement.removeAttribute("style");
              }
            }
          });
        }
      }
      update(update) {
        this.dom.style.minHeight = update.view.contentHeight + "px";
        this.setCommnet(update.view);
      }
      destroy() {
        this.dom.remove();
      }
    }
  );
}

// src/main.ts
var MyPlugin = class extends import_obsidian3.Plugin {
  onload() {
    return __async(this, null, function* () {
      this.registerEditorExtension(EditingViewPlugin(this.app));
      this.registerEvent(
        this.app.workspace.on("editor-menu", (menu, editor, view) => {
          menu.addItem((item) => {
            item.setTitle("\u63D2\u5165\u6CE8\u91CA \u{1F448}").setIcon("document").onClick(() => __async(this, null, function* () {
              new ExampleModal(this.app, (result) => {
                const id = Math.random().toString(36).slice(2);
                editor.replaceSelection(`<span class='comment-box'><span>\u{1F4DD}</span><span class="comment" style="display:none;"  id='comment-id-${id}'>${result}</span></span>`);
              }).open();
            }));
          });
        })
      );
    });
  }
  onunload() {
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsic3JjL21haW4udHMiLCAic3JjL0RpYWxvZy9kaWFsb2cudHMiLCAic3JjL1BsdWdpbi9FZGl0b3JFeHRlbnNpb24udHMiXSwKICAic291cmNlc0NvbnRlbnQiOiBbImltcG9ydCB7XHJcbiAgQXBwLFxyXG4gIE1hcmtkb3duVmlldyxcclxuICBNb2RhbCxcclxuICBOb3RpY2UsXHJcbiAgUGx1Z2luLFxyXG4gIFBsdWdpblNldHRpbmdUYWIsXHJcbiAgU2V0dGluZ1xyXG59IGZyb20gJ29ic2lkaWFuJztcclxuaW1wb3J0IHsgRXh0ZW5zaW9uIH0gZnJvbSBcIkBjb2RlbWlycm9yL3N0YXRlXCI7XHJcblxyXG5cclxuaW1wb3J0IHsgZXhhbXBsZVBsdWdpbiB9IGZyb20gJy4vRXhhbXBsZVBsdWdpbi9FeGFtcGxlUGx1Z2luJztcclxuaW1wb3J0IHsgRXhhbXBsZU1vZGFsIH0gZnJvbSAnLi9EaWFsb2cvZGlhbG9nJztcclxuaW1wb3J0IEVkaXRpbmdWaWV3UGx1Z2luIGZyb20gJy4vUGx1Z2luL0VkaXRvckV4dGVuc2lvbic7XHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgTXlQbHVnaW4gZXh0ZW5kcyBQbHVnaW4ge1xyXG5cclxuXHJcblxyXG5cclxuICBhc3luYyBvbmxvYWQoKSB7XHJcblxyXG4gICBcclxuXHJcbiAgICB0aGlzLnJlZ2lzdGVyRWRpdG9yRXh0ZW5zaW9uKEVkaXRpbmdWaWV3UGx1Z2luKHRoaXMuYXBwKSk7XHJcblxyXG4gIFxyXG5cclxuICAgIHRoaXMucmVnaXN0ZXJFdmVudChcclxuICAgICAgdGhpcy5hcHAud29ya3NwYWNlLm9uKFwiZWRpdG9yLW1lbnVcIiwgKG1lbnUsIGVkaXRvciwgdmlldykgPT4ge1xyXG4gICAgICAgIG1lbnUuYWRkSXRlbSgoaXRlbSkgPT4ge1xyXG4gICAgICAgICAgaXRlbVxyXG4gICAgICAgICAgICAuc2V0VGl0bGUoXCJcdTYzRDJcdTUxNjVcdTZDRThcdTkxQ0EgXHVEODNEXHVEQzQ4XCIpXHJcbiAgICAgICAgICAgIC5zZXRJY29uKFwiZG9jdW1lbnRcIilcclxuICAgICAgICAgICAgLm9uQ2xpY2soYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICAgIG5ldyBFeGFtcGxlTW9kYWwodGhpcy5hcHAsIChyZXN1bHQpID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGlkID0gTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc2xpY2UoMilcclxuICAgICAgICAgICAgICAgIGVkaXRvci5yZXBsYWNlU2VsZWN0aW9uKGA8c3BhbiBjbGFzcz0nY29tbWVudC1ib3gnPjxzcGFuPlx1RDgzRFx1RENERDwvc3Bhbj48c3BhbiBjbGFzcz1cImNvbW1lbnRcIiBzdHlsZT1cImRpc3BsYXk6bm9uZTtcIiAgaWQ9J2NvbW1lbnQtaWQtJHtpZH0nPiR7cmVzdWx0fTwvc3Bhbj48L3NwYW4+YCk7XHJcbiAgICAgICAgICAgICAgfSkub3BlbigpXHJcblxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgICAgfSlcclxuICAgICk7XHJcblxyXG4gIH1cclxuXHJcblxyXG4gIG9udW5sb2FkKCkge1xyXG4gICAgLy8gdGhpcy5hcHAud29ya3NwYWNlLmRldGFjaExlYXZlc09mVHlwZShWSUVXX1RZUEUpXHJcbiAgfVxyXG5cclxufVxyXG5cclxuXHJcbiIsICJpbXBvcnQgeyBBcHAsIE1vZGFsLCBTZXR0aW5nLCBUZXh0QXJlYUNvbXBvbmVudCB9IGZyb20gXCJvYnNpZGlhblwiO1xyXG5cclxuXHJcblxyXG5cclxuXHJcbmV4cG9ydCBjbGFzcyBFeGFtcGxlTW9kYWwgZXh0ZW5kcyBNb2RhbCB7XHJcbiAgcmVzdWx0OiBzdHJpbmc7XHJcbiAgb25TdWJtaXQ6IChyZXN1bHQ6IHN0cmluZykgPT4gdm9pZDtcclxuXHJcbiAgY29uc3RydWN0b3IoYXBwOiBBcHAsIG9uU3VibWl0OiAocmVzdWx0OiBzdHJpbmcpID0+IHZvaWQpIHtcclxuICAgIHN1cGVyKGFwcCk7XHJcbiAgICB0aGlzLm9uU3VibWl0ID0gb25TdWJtaXQ7XHJcbiAgfVxyXG5cclxuICBvbk9wZW4oKSB7XHJcbiAgICBjb25zdCB7IGNvbnRlbnRFbCB9ID0gdGhpcztcclxuXHJcbiAgICBjb250ZW50RWwuY3JlYXRlRWwoXCJoNlwiLCB7IHRleHQ6IFwiXHU2MEE4XHU3Njg0XHU2MEYzXHU2Q0Q1XHU2NjJGXHVGRjFGXCIgfSk7XHJcblxyXG4gICAgY29uc3Qgc3R5bGluZ1RlbXBsYXRlU2V0dGluZyA9IG5ldyBTZXR0aW5nKGNvbnRlbnRFbClcclxuXHJcbiAgICBjb25zdCBzdHlsaW5nVGVtcGxhdGVDb250ZW50ID0gbmV3IFRleHRBcmVhQ29tcG9uZW50KHN0eWxpbmdUZW1wbGF0ZVNldHRpbmcuY29udHJvbEVsKTtcclxuXHJcbiAgICBzdHlsaW5nVGVtcGxhdGVTZXR0aW5nLnNldHRpbmdFbC5zZXRBdHRyaWJ1dGUoXCJzdHlsZVwiLCBcImRpc3BsYXk6IGdyaWQ7IGdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyO1wiKTtcclxuXHJcbiAgICBzdHlsaW5nVGVtcGxhdGVDb250ZW50LmlucHV0RWwuc2V0QXR0cmlidXRlKCdzdHlsZScsICd3aWR0aDogMTAwJTsgIGhlaWdodDogMTh2aDsnKVxyXG5cclxuICAgIHN0eWxpbmdUZW1wbGF0ZUNvbnRlbnQub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XHJcblxyXG5cclxuICAgICAgdGhpcy5yZXN1bHQgPSB2YWx1ZS5yZXBsYWNlKC9cXG4vZywgXCI8YnI+XCIpOyAgLy8ucmVwbGFjZSgvLisvZywgXCI8ZGl2PiQmPC9kaXY+XCIpO1xyXG5cclxuXHJcbiAgICB9KTtcclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcbiAgICBuZXcgU2V0dGluZyhjb250ZW50RWwpXHJcbiAgICAgIC5hZGRCdXR0b24oKGJ0bikgPT5cclxuICAgICAgICBidG5cclxuICAgICAgICAgIC5zZXRCdXR0b25UZXh0KFwiXHU3ODZFXHU1QjlBXCIpXHJcbiAgICAgICAgICAuc2V0Q3RhKClcclxuICAgICAgICAgIC5vbkNsaWNrKCgpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5jbG9zZSgpO1xyXG4gICAgICAgICAgICB0aGlzLm9uU3VibWl0KHRoaXMucmVzdWx0KTtcclxuICAgICAgICAgIH0pKTtcclxuICB9XHJcblxyXG4gIG9uQ2xvc2UoKSB7XHJcbiAgICBsZXQgeyBjb250ZW50RWwgfSA9IHRoaXM7XHJcbiAgICBjb250ZW50RWwuZW1wdHkoKTtcclxuICB9XHJcbn0iLCAiaW1wb3J0IHtcclxuICAgIFZpZXdVcGRhdGUsXHJcbiAgICBQbHVnaW5WYWx1ZSxcclxuICAgIEVkaXRvclZpZXcsXHJcbiAgICBWaWV3UGx1Z2luLFxyXG59IGZyb20gXCJAY29kZW1pcnJvci92aWV3XCI7XHJcbmltcG9ydCB7IEFwcCwgTWFya2Rvd25WaWV3LCBXb3Jrc3BhY2VMZWFmLCBzZXRJY29uIH0gZnJvbSBcIm9ic2lkaWFuXCI7XHJcblxyXG5cclxuY29uc3QgbGFiZWwgPSBcIlZpZXcgbm90ZXNcIjtcclxuXHJcbmNvbnN0IGFkZFNyY0J1dHRvbiA9IChhcHA6IEFwcCkgPT4ge1xyXG4gICAgY29uc3QgYXBwbHkgPSAoKSA9PiBhcHAud29ya3NwYWNlLml0ZXJhdGVBbGxMZWF2ZXMoYWRkQnV0dG9uKGFwcCkpO1xyXG5cclxuICAgIGFwcC53b3Jrc3BhY2Uub25MYXlvdXRSZWFkeShhcHBseSk7XHJcbiAgICBhcHAud29ya3NwYWNlLm9uKFwibGF5b3V0LWNoYW5nZVwiLCBhcHBseSk7XHJcbn07XHJcblxyXG5cclxuY29uc3QgYWRkQnV0dG9uID0gKGFwcDogQXBwKSA9PiAobGVhZjogV29ya3NwYWNlTGVhZikgPT4ge1xyXG4gICAgaWYgKFxyXG4gICAgICAgIGxlYWYudmlldyBpbnN0YW5jZW9mIE1hcmtkb3duVmlldyAmJlxyXG4gICAgICAgIGxlYWYudmlldy5jb250YWluZXJFbC5xdWVyeVNlbGVjdG9yKFxyXG4gICAgICAgICAgICBgYS52aWV3LWFjdGlvblthcmlhLWxhYmVsPVwiJHtsYWJlbH1cIl1gLFxyXG4gICAgICAgICkgPT09IG51bGxcclxuICAgICkge1xyXG4gICAgICAgIGxldCB2aWV3ID0gbGVhZi52aWV3O1xyXG4gICAgICAgIGxldCBpc1dvcmsgPSBmYWxzZVxyXG4gICAgICAgIGNvbnN0IGJ1dHRvbkVsZW1lbnQgPSB2aWV3LmFkZEFjdGlvbihcInBkZi1maWxlXCIsIGxhYmVsLCAoZXZ0KSA9PiB7XHJcblxyXG5cclxuICAgICAgICAgICBcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHJpZ2h0R3V0dGVycyA9IHZpZXcuY29udGVudEVsLnF1ZXJ5U2VsZWN0b3IoJyNyaWdodC1ndXR0ZXJzJylcclxuXHJcbiAgICAgICAgICAgIGlmIChpc1dvcmspIHtcclxuICAgICAgICAgICAgICAgIGlzV29yayA9IGZhbHNlXHJcbiAgICAgICAgICAgICAgICByaWdodEd1dHRlcnMuc2V0QXR0cmlidXRlKCdzdHlsZScsICdkaXNwbGF5OmJsb2NrJylcclxuICAgICAgICAgICAgICAgIHJpZ2h0R3V0dGVycy5zZXRBdHRyaWJ1dGUoJ3N0eWxlJywgJ2JhY2tncm91bmQtY29sb3I6cmdiKDI0NiwgMjQ4LCAyNTApIWltcG9ydGFudDt3aWR0aDoyNTBweDttYXJnaW4tcmlnaHQ6IDMwcHgnKTtcclxuICAgICAgICAgICAgICAgIHNldEljb24oYnV0dG9uRWxlbWVudCwgJ3BkZi1maWxlJyk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBpc1dvcmsgPSB0cnVlXHJcbiAgICAgICAgICAgICAgICByaWdodEd1dHRlcnMuc2V0QXR0cmlidXRlKCdzdHlsZScsICdkaXNwbGF5Om5vbmUnKVxyXG4gICAgICAgICAgICAgICAgc2V0SWNvbihidXR0b25FbGVtZW50LCAnYWRkLW5vdGUtZ2x5cGgnKTtcclxuXHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgXHJcblxyXG5cclxuICAgICAgICB9KTtcclxuICAgIH1cclxufTtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIEVkaXRpbmdWaWV3UGx1Z2luKGFwcDogQXBwKSB7XHJcblxyXG4gICAgcmV0dXJuIFZpZXdQbHVnaW4uZnJvbUNsYXNzKFxyXG4gICAgICAgIGNsYXNzIEV4YW1wbGVQbHVnaW4gaW1wbGVtZW50cyBQbHVnaW5WYWx1ZSB7XHJcblxyXG5cclxuICAgICAgICAgICAgZG9tOiBIVE1MRWxlbWVudDtcclxuICAgICAgICAgICAgZml4ZWQ6IGJvb2xlYW47XHJcbiAgICAgICAgICAgIHByZXZWaWV3cG9ydDogeyBmcm9tOiBudW1iZXIsIHRvOiBudW1iZXIgfTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0cnVjdG9yKHZpZXc6IEVkaXRvclZpZXcpIHtcclxuXHJcbiAgICAgICAgICAgICAgICB0aGlzLnByZXZWaWV3cG9ydCA9IHZpZXcudmlld3BvcnQ7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRvbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kb20uY2xhc3NOYW1lID0gJ2NtLWd1dHRlcnMnO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kb20uc2V0QXR0cmlidXRlKCdzdHlsZScsICdiYWNrZ3JvdW5kLWNvbG9yOnJnYigyNDYsIDI0OCwgMjUwKSFpbXBvcnRhbnQ7d2lkdGg6MjUwcHg7bWFyZ2luLXJpZ2h0OiAzMHB4Jyk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRvbS5zZXRBdHRyaWJ1dGUoXCJpZFwiLCBcInJpZ2h0LWd1dHRlcnNcIilcclxuXHJcbiAgICAgICAgICAgICAgICB0aGlzLmRvbS5zdHlsZS5taW5IZWlnaHQgPSB2aWV3LmNvbnRlbnRIZWlnaHQgKyAncHgnO1xyXG5cclxuICAgICAgICAgICAgICAgIHZpZXcuc2Nyb2xsRE9NLmluc2VydEFmdGVyKHRoaXMuZG9tLCB2aWV3LmNvbnRlbnRET00ubmV4dFNpYmxpbmcpO1xyXG5cclxuXHJcbiAgICAgICAgICAgICAgICAvLz09PT09PT09PT09PT09PT09PT09PT09dGVzdD09PT09PT09PT09PT09PT09PT09PT09PT09XHJcblxyXG5cclxuXHJcblxyXG4gICAgICAgICAgICAgICAgYWRkU3JjQnV0dG9uKGFwcClcclxuXHJcblxyXG4gICAgICAgICAgICAgICAgLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcblxyXG4gICAgICAgICAgICB9XHJcblxyXG5cclxuXHJcblxyXG4gICAgICAgICAgICBzZXRDb21tbmV0KHZpZXc6IEVkaXRvclZpZXcpIHtcclxuXHJcblxyXG4gICAgICAgICAgICAgICAgY29uc3QgX2dldF9ndXR0ZXIgPSB2aWV3LmRvbS5xdWVyeVNlbGVjdG9yKCcjcmlnaHQtZ3V0dGVycycpXHJcbiAgICAgICAgICAgICAgICBpZiAoX2dldF9ndXR0ZXIpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgX2dldF9ndXR0ZXIuZW1wdHkoKVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBmaW5kQ29tbWVudCA9IHZpZXcuY29udGVudERPTS5xdWVyeVNlbGVjdG9yQWxsKFwiLmNvbW1lbnRcIilcclxuXHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChmaW5kQ29tbWVudC5sZW5ndGggPT09IDApIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGZpbmRTdHlsZSA9IHZpZXcuY29udGVudERPTS5xdWVyeVNlbGVjdG9yQWxsKFwiLmNtLWxpbmVcIilcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbmRTdHlsZS5mb3JFYWNoKCRlbCA9PiB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGdldFN0eWxlcyA9ICRlbC5nZXRBdHRyaWJ1dGUoJ3N0eWxlJylcclxuXHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGdldFN0eWxlcykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChnZXRTdHlsZXMuZW5kc1dpdGgoJ3RvcDowcHgnKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZWwucmVtb3ZlQXR0cmlidXRlKCdzdHlsZScpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcblxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGZpbmRDb21tZW50LmZvckVhY2goZWxlbWVudCA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlbGVtZW50KSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY29tbWVudHMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tbWVudHMuc3R5bGUudG9wID0gZWxlbWVudC5wYXJlbnRFbGVtZW50LnBhcmVudEVsZW1lbnQucGFyZW50RWxlbWVudC5vZmZzZXRUb3AgKyAncHgnXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21tZW50cy5zdHlsZS5wb3NpdGlvbiA9ICdhYnNvbHV0ZSdcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1lbnRzLnN0eWxlLnpJbmRleCA9ICc5OSdcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1lbnRzLnN0eWxlLmN1cnNvciA9ICdwb2ludGVyJ1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tbWVudHMuc3R5bGUud2hpdGVTcGFjZSA9ICdwcmUtd3JhcCdcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1lbnRzLmFkZENsYXNzKCdyaWdodENvbW1lbnRzJylcclxuXHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tbWVudHMuaW5uZXJIVE1MID0gZWxlbWVudC5pbm5lckhUTUxcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfZ2V0X2d1dHRlci5hcHBlbmQoY29tbWVudHMpXHJcblxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1lbnRzLm9uY2xpY2sgPSAoZSkgPT4ge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21tZW50cy5zZXRBdHRyaWJ1dGUoJ2NvbnRlbnRlZGl0YWJsZScsICdwbGFpbnRleHQtb25seScpXHJcblxyXG5cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tbWVudHMuc3R5bGUuY3Vyc29yID0gJ3RleHQnXHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1lbnRzLnN0eWxlLmJvcmRlciA9ICcxcHggc29saWQgIzAwZidcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcblxyXG5cclxuXHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tbWVudHMub25ibHVyID0gKGUpID0+IHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgbm9kZSA9IHZpZXcuY29udGVudERPTS5xdWVyeVNlbGVjdG9yKCcjJyArIGVsZW1lbnQuZ2V0QXR0cmlidXRlKCdpZCcpKVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBuZXdUZXh0ID0gKGUudGFyZ2V0IGFzIEhUTUxFbGVtZW50KS5pbm5lclRleHRcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgeyBzdGF0ZSB9ID0gdmlldztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcG9zaXRpb24gPSB2aWV3LnBvc0F0RE9NKG5vZGUpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBsaW5lID0gc3RhdGUuZG9jLmxpbmVBdChwb3NpdGlvbik7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IEV4cCA9IFJlZ0V4cChcIihcIiArIGVsZW1lbnQuZ2V0QXR0cmlidXRlKCdpZCcpICsgXCInPikoW1xcXFxzXFxcXFNdKj8pKDxcXC9zcGFuPilcIiwgXCJnXCIpXHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRlc3QgPSBsaW5lLnRleHQucmVwbGFjZShFeHAsICckMScgKyBuZXdUZXh0ICsgJyQzJylcclxuXHJcblxyXG5cclxuXHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZpZXcuZGlzcGF0Y2goeyBjaGFuZ2VzOiB7IGZyb206IGxpbmUuZnJvbSwgdG86IGxpbmUudG8sIGluc2VydDogdGVzdC5yZXBsYWNlKC9cXG4vZywgXCI8YnI+XCIpLCB9IH0pXHJcblxyXG5cclxuXHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbW1lbnRzLm9mZnNldEhlaWdodCArIDUgPj0gZWxlbWVudC5wYXJlbnRFbGVtZW50LnBhcmVudEVsZW1lbnQucGFyZW50RWxlbWVudC5vZmZzZXRIZWlnaHQpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5wYXJlbnRFbGVtZW50LnBhcmVudEVsZW1lbnQucGFyZW50RWxlbWVudC5zZXRBdHRyaWJ1dGUoJ3N0eWxlJywgYGhlaWdodDoke2NvbW1lbnRzLm9mZnNldEhlaWdodCArIDV9cHg7dG9wOjBweGApXHJcblxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQucGFyZW50RWxlbWVudC5wYXJlbnRFbGVtZW50LnBhcmVudEVsZW1lbnQucmVtb3ZlQXR0cmlidXRlKCdzdHlsZScpXHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuXHJcblxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG5cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHVwZGF0ZSh1cGRhdGU6IFZpZXdVcGRhdGUpIHtcclxuXHJcblxyXG4gICAgICAgICAgICAgICAgdGhpcy5kb20uc3R5bGUubWluSGVpZ2h0ID0gdXBkYXRlLnZpZXcuY29udGVudEhlaWdodCArICdweCc7XHJcblxyXG4gICAgICAgICAgICAgICAgdGhpcy5zZXRDb21tbmV0KHVwZGF0ZS52aWV3KVxyXG5cclxuXHJcblxyXG5cclxuXHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGRlc3Ryb3koKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRvbS5yZW1vdmUoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICApO1xyXG59Il0sCiAgIm1hcHBpbmdzIjogIjs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEsSUFBQUEsbUJBUU87OztBQ1JQLHNCQUF1RDtBQU1oRCxJQUFNLGVBQU4sY0FBMkIsc0JBQU07QUFBQSxFQUl0QyxZQUFZLEtBQVUsVUFBb0M7QUFDeEQsVUFBTSxHQUFHO0FBQ1QsU0FB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
