/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var h=Object.defineProperty;var C=Object.getOwnPropertyDescriptor;var M=Object.getOwnPropertyNames;var T=Object.prototype.hasOwnProperty;var w=(s,t)=>{for(var n in t)h(s,n,{get:t[n],enumerable:!0})},H=(s,t,n,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of M(t))!T.call(s,o)&&o!==n&&h(s,o,{get:()=>t[o],enumerable:!(i=C(t,o))||i.enumerable});return s};var V=s=>H(h({},"__esModule",{value:!0}),s);var c=(s,t,n)=>new Promise((i,o)=>{var e=l=>{try{m(n.next(l))}catch(a){o(a)}},r=l=>{try{m(n.throw(l))}catch(a){o(a)}},m=l=>l.done?i(l.value):Promise.resolve(l.value).then(e,r);m((n=n.apply(s,t)).next())});var D={};w(D,{default:()=>g});module.exports=V(D);var x=require("obsidian");var y=require("@codemirror/view"),f=class{constructor(t){this.prevViewport=t.viewport,this.dom=document.createElement("div"),this.dom.className="cm-gutters",this.dom.setAttribute("style","background-color:rgb(246, 248, 250)!important;width:200px;margin-right: 30px"),this.dom.setAttribute("id","right-gutters"),this.dom.style.minHeight=t.contentHeight+"px",t.scrollDOM.insertAfter(this.dom,t.contentDOM.nextSibling)}setCommnet(t){let n=t.dom.querySelector("#right-gutters");if(n){n.empty();let i=t.contentDOM.querySelectorAll(".comment");i.length===0&&t.contentDOM.querySelectorAll(".cm-line").forEach(e=>{let r=e.getAttribute("style");r&&r.endsWith("top:0px")&&e.removeAttribute("style")}),i.forEach(o=>{if(o){let e=document.createElement("div");e.style.top=o.parentElement.parentElement.parentElement.offsetTop+"px",e.style.position="absolute",e.style.zIndex="99",e.style.cursor="pointer",e.style.whiteSpace="pre-wrap",e.addClass("rightComments"),e.innerHTML=o.innerHTML,n.append(e),e.onclick=r=>{e.setAttribute("contenteditable","plaintext-only"),e.style.cursor="text",e.style.border="1px solid #00f"},e.onblur=r=>{let m=t.contentDOM.querySelector("#"+o.getAttribute("id")),l=r.target.innerText,{state:a}=t,b=t.posAtDOM(m),u=a.doc.lineAt(b),A=RegExp("("+o.getAttribute("id")+"'>)([\\s\\S]*?)(</span>)","g"),S=u.text.replace(A,"$1"+l+"$3");t.dispatch({changes:{from:u.from,to:u.to,insert:S.replace(/\n/g,"<br>")}})},e.offsetHeight+5>=o.parentElement.parentElement.parentElement.offsetHeight?o.parentElement.parentElement.parentElement.setAttribute("style",`height:${e.offsetHeight+5}px;top:0px`):o.parentElement.parentElement.parentElement.removeAttribute("style")}})}}update(t){this.dom.style.minHeight=t.view.contentHeight+"px",this.setCommnet(t.view)}destroy(){this.dom.remove()}},E=y.ViewPlugin.fromClass(f);var p=require("obsidian");var d=class extends p.Modal{constructor(n,i){super(n);this.onSubmit=i}onOpen(){let{contentEl:n}=this;n.createEl("h6",{text:"\u60A8\u7684\u60F3\u6CD5\u662F\uFF1F"});let i=new p.Setting(n),o=new p.TextAreaComponent(i.controlEl);i.settingEl.setAttribute("style","display: grid; grid-template-columns: 1fr;"),o.inputEl.setAttribute("style","width: 100%;  height: 18vh;"),o.onChange(e=>c(this,null,function*(){this.result=e.replace(/\n/g,"<br>")})),new p.Setting(n).addButton(e=>e.setButtonText("\u786E\u5B9A").setCta().onClick(()=>{this.close(),this.onSubmit(this.result)}))}onClose(){let{contentEl:n}=this;n.empty()}};var g=class extends x.Plugin{onload(){return c(this,null,function*(){this.registerEditorExtension(E),this.registerEvent(this.app.workspace.on("editor-menu",(t,n,i)=>{t.addItem(o=>{o.setTitle("\u63D2\u5165\u6CE8\u91CA \u{1F448}").setIcon("document").onClick(()=>c(this,null,function*(){new d(this.app,e=>{let r=Math.random().toString(36).slice(2);n.replaceSelection(`<span class='comment-box'><span>\u{1F4DD}</span><span class="comment" style="display:none;"  id='comment-id-${r}'>${e}</span></span>`)}).open()}))})}))})}onunload(){}};
