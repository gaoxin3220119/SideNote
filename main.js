/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var b=Object.defineProperty;var T=Object.getOwnPropertyDescriptor;var v=Object.getOwnPropertyNames;var V=Object.prototype.hasOwnProperty;var D=(o,s)=>{for(var e in s)b(o,e,{get:s[e],enumerable:!0})},H=(o,s,e,t)=>{if(s&&typeof s=="object"||typeof s=="function")for(let i of v(s))!V.call(o,i)&&i!==e&&b(o,i,{get:()=>s[i],enumerable:!(t=T(s,i))||t.enumerable});return o};var L=o=>H(b({},"__esModule",{value:!0}),o);var p=(o,s,e)=>new Promise((t,i)=>{var l=a=>{try{n(e.next(a))}catch(g){i(g)}},r=a=>{try{n(e.throw(a))}catch(g){i(g)}},n=a=>a.done?t(a.value):Promise.resolve(a.value).then(l,r);n((e=e.apply(o,s)).next())});var I={};D(I,{default:()=>y});module.exports=L(I);var S=require("obsidian");var c=require("obsidian");var u=class extends c.Modal{constructor(e,t){super(e);this.onSubmit=t}onOpen(){let{contentEl:e}=this;e.createEl("h6",{text:"\u60A8\u7684\u60F3\u6CD5\u662F\uFF1F"});let t=new c.Setting(e),i=new c.TextAreaComponent(t.controlEl);t.settingEl.setAttribute("style","display: grid; grid-template-columns: 1fr;"),i.inputEl.setAttribute("style","width: 100%;  height: 18vh;"),i.onChange(l=>p(this,null,function*(){this.result=l.replace(/\n/g,"<br>")})),new c.Setting(e).addButton(l=>l.setButtonText("\u786E\u5B9A").setCta().onClick(()=>{this.close(),this.onSubmit(this.result)}))}onClose(){let{contentEl:e}=this;e.empty()}};var x=require("@codemirror/view"),d=require("obsidian"),w="View notes",$=(o,s)=>{let e=()=>o.workspace.iterateAllLeaves(O(o,s));o.workspace.onLayoutReady(e),o.workspace.on("layout-change",e)},O=(o,s)=>e=>{if(e.view instanceof d.MarkdownView&&e.view.containerEl.querySelector(`a.view-action[aria-label="${w}"]`)===null){let t=e.view,i=!1,l=t.addAction("pdf-file",w,r=>{let n=t.contentEl.querySelector("#right-gutters");i?(i=!1,n.setAttribute("style","display:block"),n.setAttribute("style",`background-color:${s.settings.backgroundColor}!important;width:${s.settings.width}px;margin-right: 30px`),(0,d.setIcon)(l,"pdf-file")):(i=!0,n.setAttribute("style","display:none"),(0,d.setIcon)(l,"add-note-glyph"))})}};function E(o,s){return x.ViewPlugin.fromClass(class{constructor(t){this.prevViewport=t.viewport,this.dom=document.createElement("div"),this.dom.className="cm-gutters",this.dom.setAttribute("style",`background-color:${s.settings.backgroundColor}!important;width:${s.settings.width}px;margin-right: 30px`),this.dom.setAttribute("id","right-gutters"),this.dom.style.minHeight=t.contentHeight+"px",t.scrollDOM.insertAfter(this.dom,t.contentDOM.nextSibling),$(o,s)}setCommnet(t){let i=t.dom.querySelector("#right-gutters");if(i){i.empty();let l=t.contentDOM.querySelectorAll(".comment");l.length===0&&t.contentDOM.querySelectorAll(".cm-line").forEach(n=>{let a=n.getAttribute("style");a&&a.endsWith("top:0px")&&n.removeAttribute("style")}),l.forEach(r=>{if(r){let n=document.createElement("div");n.style.top=r.parentElement.parentElement.parentElement.offsetTop+"px",n.style.position="absolute",n.style.zIndex="99",n.style.cursor="pointer",n.style.whiteSpace="pre-wrap",n.addClass("rightComments"),n.innerHTML=r.innerHTML,i.append(n),n.onclick=a=>{n.setAttribute("contenteditable","plaintext-only"),n.style.cursor="text",n.style.border="1px solid #00f"},n.onblur=a=>{let g=t.contentDOM.querySelector("#"+r.getAttribute("id")),A=a.target.innerText,{state:P}=t,k=t.posAtDOM(g),f=P.doc.lineAt(k),C=RegExp("("+r.getAttribute("id")+"'>)([\\s\\S]*?)(</span>)","g"),M=f.text.replace(C,"$1"+A+"$3");t.dispatch({changes:{from:f.from,to:f.to,insert:M.replace(/\n/g,"<br>")}})},n.offsetHeight+5>=r.parentElement.parentElement.parentElement.offsetHeight?r.parentElement.parentElement.parentElement.setAttribute("style",`height:${n.offsetHeight+5}px;top:0px`):r.parentElement.parentElement.parentElement.removeAttribute("style")}})}}update(t){this.dom.style.minHeight=t.view.contentHeight+"px",this.setCommnet(t.view)}destroy(){this.dom.remove()}})}var m=require("obsidian");var h=class extends m.PluginSettingTab{constructor(e,t){super(e,t);this.plugin=t}display(){let{containerEl:e}=this;e.empty(),new m.Setting(e).setName("\u5BBD\u5EA6").setDesc("\u7B14\u8BB0\u533A\u5BBD\u5EA6").addText(t=>t.setPlaceholder("250").setValue(this.plugin.settings.width).onChange(i=>p(this,null,function*(){this.plugin.settings.width=i,yield this.plugin.saveSettings()}))),new m.Setting(e).setName("\u80CC\u666F\u8272").setDesc("\u7B14\u8BB0\u533A\u80CC\u666F\u8272").addText(t=>t.setPlaceholder("rgb(246, 248, 250)").setValue(this.plugin.settings.backgroundColor).onChange(i=>p(this,null,function*(){this.plugin.settings.backgroundColor=i,yield this.plugin.saveSettings()})))}};var q={width:"250",backgroundColor:"rgb(246, 248, 250)"},y=class extends S.Plugin{onload(){return p(this,null,function*(){yield this.loadSettings(),this.addSettingTab(new h(this.app,this)),this.registerEditorExtension(E(this.app,this)),this.registerEvent(this.app.workspace.on("editor-menu",(e,t,i)=>{e.addItem(l=>{l.setTitle("\u63D2\u5165\u6CE8\u91CA \u{1F448}").setIcon("document").onClick(()=>p(this,null,function*(){new u(this.app,r=>{let n=Math.random().toString(36).slice(2);t.replaceSelection(`<span class='comment-box'><span>\u{1F4DD}</span><span class="comment" style="display:none;"  id='comment-id-${n}'>${r}</span></span>`)}).open()}))})}))})}loadSettings(){return p(this,null,function*(){this.settings=Object.assign({},q,yield this.loadData())})}saveSettings(){return p(this,null,function*(){yield this.saveData(this.settings)})}onunload(){}};
