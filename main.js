/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var f=Object.defineProperty;var V=Object.getOwnPropertyDescriptor;var M=Object.getOwnPropertyNames;var v=Object.prototype.hasOwnProperty;var C=(o,n)=>{for(var t in n)f(o,t,{get:n[t],enumerable:!0})},T=(o,n,t,s)=>{if(n&&typeof n=="object"||typeof n=="function")for(let i of M(n))!v.call(o,i)&&i!==t&&f(o,i,{get:()=>n[i],enumerable:!(s=V(n,i))||s.enumerable});return o};var H=o=>T(f({},"__esModule",{value:!0}),o);var m=(o,n,t)=>new Promise((s,i)=>{var r=a=>{try{l(t.next(a))}catch(c){i(c)}},e=a=>{try{l(t.throw(a))}catch(c){i(c)}},l=a=>a.done?s(a.value):Promise.resolve(a.value).then(r,e);l((t=t.apply(o,n)).next())});var O={};C(O,{default:()=>g});module.exports=H(O);var x=require("obsidian");var p=require("obsidian");var u=class extends p.Modal{constructor(t,s){super(t);this.onSubmit=s}onOpen(){let{contentEl:t}=this;t.createEl("h6",{text:"\u60A8\u7684\u60F3\u6CD5\u662F\uFF1F"});let s=new p.Setting(t),i=new p.TextAreaComponent(s.controlEl);s.settingEl.setAttribute("style","display: grid; grid-template-columns: 1fr;"),i.inputEl.setAttribute("style","width: 100%;  height: 18vh;"),i.onChange(r=>m(this,null,function*(){this.result=r.replace(/\n/g,"<br>")})),new p.Setting(t).addButton(r=>r.setButtonText("\u786E\u5B9A").setCta().onClick(()=>{this.close(),this.onSubmit(this.result)}))}onClose(){let{contentEl:t}=this;t.empty()}};var b=require("@codemirror/view"),d=require("obsidian"),E="View notes",L=o=>{let n=()=>o.workspace.iterateAllLeaves(P(o));o.workspace.onLayoutReady(n),o.workspace.on("layout-change",n)},P=o=>n=>{if(n.view instanceof d.MarkdownView&&n.view.containerEl.querySelector(`a.view-action[aria-label="${E}"]`)===null){let t=n.view,s=!1,i=t.addAction("pdf-file",E,r=>{let e=t.contentEl.querySelector("#right-gutters");s?(s=!1,e.setAttribute("style","display:block"),e.setAttribute("style","background-color:rgb(246, 248, 250)!important;width:250px;margin-right: 30px"),(0,d.setIcon)(i,"pdf-file")):(s=!0,e.setAttribute("style","display:none"),(0,d.setIcon)(i,"add-note-glyph"))})}};function y(o){return b.ViewPlugin.fromClass(class{constructor(t){this.prevViewport=t.viewport,this.dom=document.createElement("div"),this.dom.className="cm-gutters",this.dom.setAttribute("style","background-color:rgb(246, 248, 250)!important;width:250px;margin-right: 30px"),this.dom.setAttribute("id","right-gutters"),this.dom.style.minHeight=t.contentHeight+"px",t.scrollDOM.insertAfter(this.dom,t.contentDOM.nextSibling),L(o)}setCommnet(t){let s=t.dom.querySelector("#right-gutters");if(s){s.empty();let i=t.contentDOM.querySelectorAll(".comment");i.length===0&&t.contentDOM.querySelectorAll(".cm-line").forEach(e=>{let l=e.getAttribute("style");l&&l.endsWith("top:0px")&&e.removeAttribute("style")}),i.forEach(r=>{if(r){let e=document.createElement("div");e.style.top=r.parentElement.parentElement.parentElement.offsetTop+"px",e.style.position="absolute",e.style.zIndex="99",e.style.cursor="pointer",e.style.whiteSpace="pre-wrap",e.addClass("rightComments"),e.innerHTML=r.innerHTML,s.append(e),e.onclick=l=>{e.setAttribute("contenteditable","plaintext-only"),e.style.cursor="text",e.style.border="1px solid #00f"},e.onblur=l=>{let a=t.contentDOM.querySelector("#"+r.getAttribute("id")),c=l.target.innerText,{state:w}=t,A=t.posAtDOM(a),h=w.doc.lineAt(A),S=RegExp("("+r.getAttribute("id")+"'>)([\\s\\S]*?)(</span>)","g"),k=h.text.replace(S,"$1"+c+"$3");t.dispatch({changes:{from:h.from,to:h.to,insert:k.replace(/\n/g,"<br>")}})},e.offsetHeight+5>=r.parentElement.parentElement.parentElement.offsetHeight?r.parentElement.parentElement.parentElement.setAttribute("style",`height:${e.offsetHeight+5}px;top:0px`):r.parentElement.parentElement.parentElement.removeAttribute("style")}})}}update(t){this.dom.style.minHeight=t.view.contentHeight+"px",this.setCommnet(t.view)}destroy(){this.dom.remove()}})}var g=class extends x.Plugin{onload(){return m(this,null,function*(){this.registerEditorExtension(y(this.app)),this.registerEvent(this.app.workspace.on("editor-menu",(n,t,s)=>{n.addItem(i=>{i.setTitle("\u63D2\u5165\u6CE8\u91CA \u{1F448}").setIcon("document").onClick(()=>m(this,null,function*(){new u(this.app,r=>{let e=Math.random().toString(36).slice(2);t.replaceSelection(`<span class='comment-box'><span>\u{1F4DD}</span><span class="comment" style="display:none;"  id='comment-id-${e}'>${r}</span></span>`)}).open()}))})}))})}onunload(){}};
