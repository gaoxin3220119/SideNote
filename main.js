/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var h=Object.defineProperty;var C=Object.getOwnPropertyDescriptor;var M=Object.getOwnPropertyNames;var T=Object.prototype.hasOwnProperty;var w=(i,t)=>{for(var o in t)h(i,o,{get:t[o],enumerable:!0})},H=(i,t,o,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of M(t))!T.call(i,n)&&n!==o&&h(i,n,{get:()=>t[n],enumerable:!(s=C(t,n))||s.enumerable});return i};var V=i=>H(h({},"__esModule",{value:!0}),i);var c=(i,t,o)=>new Promise((s,n)=>{var e=l=>{try{m(o.next(l))}catch(a){n(a)}},r=l=>{try{m(o.throw(l))}catch(a){n(a)}},m=l=>l.done?s(l.value):Promise.resolve(l.value).then(e,r);m((o=o.apply(i,t)).next())});var D={};w(D,{default:()=>u});module.exports=V(D);var x=require("obsidian");var y=require("@codemirror/view"),f=class{constructor(t){this.prevViewport=t.viewport,this.dom=document.createElement("div"),this.dom.className="cm-gutters",this.dom.setAttribute("style","background-color:rgb(246, 248, 250);width:200px"),this.dom.setAttribute("id","right-gutters"),this.dom.style.minHeight=t.contentHeight+"px",t.scrollDOM.insertAfter(this.dom,t.contentDOM.nextSibling)}setCommnet(t){let o=t.dom.querySelector("#right-gutters");if(o){o.empty();let s=t.contentDOM.querySelectorAll(".comment");s.length===0&&t.contentDOM.querySelectorAll(".cm-line").forEach(e=>{let r=e.getAttribute("style");r&&r.endsWith("top:0px")&&e.removeAttribute("style")}),s.forEach(n=>{if(n){let e=document.createElement("div");e.style.top=n.parentElement.parentElement.parentElement.offsetTop+"px",e.style.position="absolute",e.style.zIndex="99",e.style.cursor="pointer",e.style.whiteSpace="pre-wrap",e.addClass("rightComments"),e.innerHTML=n.innerHTML,o.append(e),e.onclick=r=>{e.setAttribute("contenteditable","plaintext-only"),e.style.cursor="text",e.style.border="1px solid #00f"},e.onblur=r=>{let m=t.contentDOM.querySelector("#"+n.getAttribute("id")),l=r.target.innerText,{state:a}=t,b=t.posAtDOM(m),g=a.doc.lineAt(b),A=RegExp("("+n.getAttribute("id")+"'>)([\\s\\S]*?)(</span>)","g"),S=g.text.replace(A,"$1"+l+"$3");t.dispatch({changes:{from:g.from,to:g.to,insert:S.replace(/\n/g,"<br>")}})},e.offsetHeight+5>=n.parentElement.parentElement.parentElement.offsetHeight?n.parentElement.parentElement.parentElement.setAttribute("style",`height:${e.offsetHeight+5}px;top:0px`):n.parentElement.parentElement.parentElement.removeAttribute("style")}})}}update(t){this.dom.style.minHeight=t.view.contentHeight+"px",this.setCommnet(t.view)}destroy(){this.dom.remove()}},E=y.ViewPlugin.fromClass(f);var p=require("obsidian");var d=class extends p.Modal{constructor(o,s){super(o);this.onSubmit=s}onOpen(){let{contentEl:o}=this;o.createEl("h6",{text:"\u60A8\u7684\u60F3\u6CD5\u662F\uFF1F"});let s=new p.Setting(o),n=new p.TextAreaComponent(s.controlEl);s.settingEl.setAttribute("style","display: grid; grid-template-columns: 1fr;"),n.inputEl.setAttribute("style","width: 100%;  height: 18vh;"),n.onChange(e=>c(this,null,function*(){this.result=e.replace(/\n/g,"<br>")})),new p.Setting(o).addButton(e=>e.setButtonText("\u786E\u5B9A").setCta().onClick(()=>{this.close(),this.onSubmit(this.result)}))}onClose(){let{contentEl:o}=this;o.empty()}};var u=class extends x.Plugin{onload(){return c(this,null,function*(){this.registerEditorExtension(E),this.registerEvent(this.app.workspace.on("editor-menu",(t,o,s)=>{t.addItem(n=>{n.setTitle("\u63D2\u5165\u6CE8\u91CA \u{1F448}").setIcon("document").onClick(()=>c(this,null,function*(){new d(this.app,e=>{let r=Math.random().toString(36).slice(2);o.replaceSelection(`<span class='comment-box'><span>\u{1F4DD}</span><span class="comment" style="display:none;"  id='comment-id-${r}'>${e}</span></span>`)}).open()}))})}))})}onunload(){}};
